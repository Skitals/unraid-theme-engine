Menu="UserPreferences"
Title="Theme Engine"
Icon="paint-brush"
---
<?php
extract(parse_plugin_cfg('theme.engine',true));
?>

<div id="title">Base Theme</div>
<form markdown="1" name="display_settings" method="POST" action="/update.php" target="progressFrame" onsubmit="saveFontSize();upload();">
<input type="hidden" name="#file" value="dynamix/dynamix.cfg">
<input type="hidden" name="#section" value="display">
Base Theme:
: <select name="theme" size="1" id="BaseTheme">
  <?foreach (glob("$docroot/webGui/styles/dynamix-*.css") as $themes):?>
  <?$theme = substr(basename($themes,'.css'),8);?>
  <?=mk_option($display['theme'], $theme, ucfirst($theme))?>
  <?endforeach;?>
  </select>

<input type="submit" name="#default" value="Default" onclick="filename='reset'">
: <input type="submit" name="#apply" value="Apply" disabled>
</form>

<div id="title">Theme Settings</div>
<form markdown="1" name="display_settings" method="POST" action="/update.php" target="progressFrame" onsubmit="saveFontSize();upload();">
<input type="hidden" name="#file" value="theme.engine/theme.engine.cfg">
<input type="hidden" name="#section" value="ThemeEngine">
Enable Theme Engine:
: <select name="enabled" size="1">
  <?=mk_option($ThemeEngine['enabled'], "0", "No")?>
  <?=mk_option($ThemeEngine['enabled'], "1", "Yes")?>
  </select>


Desaturate images/icons (0-100):
: <input type="number" min="0" max="100" pattern="^[0-9][0-9]?$|100$" class="narrow" name="grayscale" value="<?php echo $ThemeEngine['grayscale']; ?>">


Header text color:
: <input type="text" pattern="#[0-9a-fA-F]{6}" class="narrow" name="headertext" value="<?php echo $ThemeEngine['headertext']; ?>">
<span class="switcher dc-color-input-switcher"><i class="fa fa-paint-brush" title="Toggle Color Picker"></i></span>
<span class="switcher dc-color-input-clearer"><i class="fa fa-times"></i></span>


Header background color:
: <input type="text" pattern="#[0-9a-fA-F]{6}" class="narrow" name="headerbackground" value="<?php echo $ThemeEngine['headerbackground']; ?>">
<span class="switcher dc-color-input-switcher"><i class="fa fa-paint-brush"></i></span>
<span class="switcher dc-color-input-clearer"><i class="fa fa-times"></i></span>


Menu text color:
: <input type="text" pattern="#[0-9a-fA-F]{6}" class="narrow" name="menutext" value="<?php echo $ThemeEngine['menutext']; ?>">
<span class="switcher dc-color-input-switcher"><i class="fa fa-paint-brush"></i></span>
<span class="switcher dc-color-input-clearer"><i class="fa fa-times"></i></span>


Menu background color:
: <input type="text" pattern="#[0-9a-fA-F]{6}" class="narrow" name="menubackground" value="<?php echo $ThemeEngine['menubackground']; ?>">
<span class="switcher dc-color-input-switcher"><i class="fa fa-paint-brush"></i></span>
<span class="switcher dc-color-input-clearer"><i class="fa fa-times"></i></span>


Text color:
: <input type="text" pattern="#[0-9a-fA-F]{6}" class="narrow" name="text" value="<?php echo $ThemeEngine['text']; ?>">
<span class="switcher dc-color-input-switcher"><i class="fa fa-paint-brush"></i></span>
<span class="switcher dc-color-input-clearer"><i class="fa fa-times"></i></span>


Link color:
: <input type="text" pattern="#[0-9a-fA-F]{6}" class="narrow" name="link" value="<?php echo $ThemeEngine['link']; ?>">
<span class="switcher dc-color-input-switcher"><i class="fa fa-paint-brush"></i></span>
<span class="switcher dc-color-input-clearer"><i class="fa fa-times"></i></span>


Blue text:
: <input type="text" pattern="#[0-9a-fA-F]{6}" class="narrow" name="bluetext" value="<?php echo $ThemeEngine['bluetext']; ?>">
<span class="switcher dc-color-input-switcher"><i class="fa fa-paint-brush"></i></span>
<span class="switcher dc-color-input-clearer"><i class="fa fa-times"></i></span>


Green text (passed):
: <input type="text" pattern="#[0-9a-fA-F]{6}" class="narrow" name="greentext" value="<?php echo $ThemeEngine['greentext']; ?>">
<span class="switcher dc-color-input-switcher"><i class="fa fa-paint-brush"></i></span>
<span class="switcher dc-color-input-clearer"><i class="fa fa-times"></i></span>


Orange text (warning):
: <input type="text" pattern="#[0-9a-fA-F]{6}" class="narrow" name="orangetext" value="<?php echo $ThemeEngine['orangetext']; ?>">
<span class="switcher dc-color-input-switcher"><i class="fa fa-paint-brush"></i></span>
<span class="switcher dc-color-input-clearer"><i class="fa fa-times"></i></span>


Red text (failed):
: <input type="text" pattern="#[0-9a-fA-F]{6}" class="narrow" name="redtext" value="<?php echo $ThemeEngine['redtext']; ?>">
<span class="switcher dc-color-input-switcher"><i class="fa fa-paint-brush"></i></span>
<span class="switcher dc-color-input-clearer"><i class="fa fa-times"></i></span>


Green orb:
: <input type="text" pattern="#[0-9a-fA-F]{6}" class="narrow" name="greenorb" value="<?php echo $ThemeEngine['greenorb']; ?>">
<span class="switcher dc-color-input-switcher"><i class="fa fa-paint-brush"></i></span>
<span class="switcher dc-color-input-clearer"><i class="fa fa-times"></i></span>


Blue orb:
: <input type="text" pattern="#[0-9a-fA-F]{6}" class="narrow" name="blueorb" value="<?php echo $ThemeEngine['blueorb']; ?>">
<span class="switcher dc-color-input-switcher"><i class="fa fa-paint-brush"></i></span>
<span class="switcher dc-color-input-clearer"><i class="fa fa-times"></i></span>


Button text color:
: <input type="text" pattern="#[0-9a-fA-F]{6}" class="narrow" name="buttontext" value="<?php echo $ThemeEngine['buttontext']; ?>">
<span class="switcher dc-color-input-switcher"><i class="fa fa-paint-brush"></i></span>
<span class="switcher dc-color-input-clearer"><i class="fa fa-times"></i></span>


Button background color:
: <input type="text" pattern="#[0-9a-fA-F]{6}" class="narrow" name="buttonbackground" value="<?php echo $ThemeEngine['buttonbackground']; ?>">
<span class="switcher dc-color-input-switcher"><i class="fa fa-paint-brush"></i></span>
<span class="switcher dc-color-input-clearer"><i class="fa fa-times"></i></span>


Button hover text color:
: <input type="text" pattern="#[0-9a-fA-F]{6}" class="narrow" name="buttonhtext" value="<?php echo $ThemeEngine['buttonhtext']; ?>">
<span class="switcher dc-color-input-switcher"><i class="fa fa-paint-brush"></i></span>
<span class="switcher dc-color-input-clearer"><i class="fa fa-times"></i></span>


Button hover background color:
: <input type="text" pattern="#[0-9a-fA-F]{6}" class="narrow" name="buttonhbackground" value="<?php echo $ThemeEngine['buttonhbackground']; ?>">
<span class="switcher dc-color-input-switcher"><i class="fa fa-paint-brush"></i></span>
<span class="switcher dc-color-input-clearer"><i class="fa fa-times"></i></span>


<input type="submit" name="#default" value="Clear Settings" onclick="filename='reset'" style="color:#fff;background-color:#890008">
: <input type="submit" name="#apply" id="apply" value="Apply" disabled><input type="button" id="done" value="Done" onclick="done()">
</form>

<div id="title">Export Theme</div>
<form markdown="1" id="exportForm" onSubmit="return false;">
Theme Name:
: <input type="text" pattern="[a-zA-Z0-9]{1,}" class="narrow" name="text" id="MyTheme" value="MyTheme">

Apply settings before exporting.
: <input type="submit" value="Export">
</form>

<div id="title">Import Theme</div>
<form markdown="1" id="importForm" onSubmit="return false;">
Theme Name:
: <select name="theme" size="1" id="SelectedTheme">
  <?foreach (glob("/boot/config/plugins/theme.engine/themes/*.cfg") as $themes):?>
  <?$theme = basename($themes,'.cfg');?>
  <?=mk_option($display['theme'], $theme, ucfirst($theme))?>
  <?endforeach;?>
  </select>

Current settings will be overwriten.
: <input type="submit" value="Import"><input type="submit" value="Delete" onclick="DeleteTheme();return false;" id="deletebutton" disabled><input type="checkbox" onchange="document.getElementById('deletebutton').disabled = !this.checked;">Confirm Delete.
</form>


<script>

$(function() {
	if ( typeof caPluginUpdateCheck === "function" ) {
		caPluginUpdateCheck("theme.engine.plg",{name:"Theme Engine"});
	}
	var jArray = <?php echo json_encode($ThemeEngine); ?>;
	for(var index in jArray) {
		var tempStr = document.getElementsByName(index)[0];
		if (tempStr.type == 'text' && jArray[index].length > 3) {
			tempStr.type = 'color';
		} else {
			tempStr.type = 'text';
		}
	}
});

var $exportForm = $('#exportForm');
var $importForm = $('#importForm');

$exportForm.on('submit', function(){
	var themename = document.getElementById("MyTheme");
	var basetheme = document.getElementById("BaseTheme"); 
	$.get( "/plugins/theme.engine/scripts/export.php", { name: themename.value, base: basetheme.value } )
	.done(function( data ) {
		alert( data );
		location.reload();
	});
});

$importForm.on('submit', function(){
	var themename = document.getElementById("SelectedTheme");
	var basename = themename.value.split('-')[1]
            $.ajax({
                type: "POST",
                url: "/update.php" ,
                data: { "#file":"/boot/config/plugins/dynamix/dynamix.cfg","#section":"display","theme":basename,"#apply":"Enable Dark" },
                success : function() {
                }
            });
	$.get( "/plugins/theme.engine/scripts/import.php", { name: themename.value, base: basename } )
	.done(function( data ) {
	alert(  data );
	location.reload();
	});
});

function DeleteTheme() {
	var themename = document.getElementById("SelectedTheme");
	var r = confirm("This will delete the theme permenantly. Press OK to confirm.");
	if (r == true){
		$.get( "/plugins/theme.engine/scripts/delete.php", { name: themename.value } )
			.done(function( data ) {
			alert( data );
			location.reload();
		});
	}
}

$(document).on('click', '.dc-color-input-switcher', function() {
	var dcInputColor = $(this).prev();
	if (dcInputColor.attr('type') == 'text') {
		if (!dcInputColor.attr('value')) { 
			dcInputColor.attr('value', '#000000');
	                var form = $(this).parentsUntil('form').parent();
			form.find('input[value="Apply"],input[name="cmdEditShare"],input[name="cmdUserEdit"]').not('input.lock').prop('disabled',false);

		}
		dcInputColor.attr('type', 'color');
	} else {
		dcInputColor.attr('type', 'text');
	}
});

$(document).on('click', '.dc-color-input-clearer', function() {
	var dcInputColor2 = $(this).prev().prev();
	if (dcInputColor2.attr('value')) {
		if (dcInputColor2.attr('type') == 'color') {
			dcInputColor2.attr('type', 'text');
		}
		dcInputColor2.val('');
		var form = $(this).parentsUntil('form').parent();
		form.find('input[value="Apply"],input[name="cmdEditShare"],input[name="cmdUserEdit"]').not('input.lock').prop('disabled',false);
		form.find('input[value="Done"]').not('input.lock').val('Reset').prop('onclick',null).off('click').click(function(){refresh(form.offset().top)});
	}
});

</script>
